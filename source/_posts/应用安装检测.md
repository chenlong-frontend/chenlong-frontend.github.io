---
title: 应用安装检测
author: 陈龙
date: 2023-03-04 13:02:26
tags: [应用安装]
categories: [应用安装]
---

## 需求背景

用户首次通过 pc 链接入会调起应用失败后，产品希望能够自动下载安装包，这就要求我们能够检测到当前页面是否成功调起应用

## 核心技术点

当浏览器调起应用时，会弹出一个顶部弹窗，提示用户点击之后调起应用，有了这个弹窗说明，用户安装了客户端

借助这一特性，我们可以监听页面的 `onblur` 事件，监听到这个事件则表明页面弹起了确认框

但是这个时间要非常之短，不然用户可能会主动点击浏览器之外从而触发 `onblur`

核心代码为下：

```js
window.onblur = () => {
  this.isCallAppStart = true;
  setTimeout(() => {
    window.onblur = null;
  }, 3);
};
```

需要注意的时这个方法在 safari 上不适用，safari 现在方案是首次打开的时候下载一次
